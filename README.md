# 大喜利童話（さるかに召還合戦）🦀⚔️🐒

「さるかに合戦」をベースにしたインタラクティブな召還合戦アプリです。子カニとサルが様々なキャラクターを召喚して戦う、オリジナルの物語を作成できます。

## 🌟 特徴

- 🦀 カニとサルの絵文字付きタイトル
- 📖 Web小説のような読みやすいUI
- 🎨 カニをイメージした薄い赤色の背景
- 🤖 Gemini AIを使用した動的な物語生成
- ⚔️ 5ラウンドの戦闘システム
- 🎭 インタラクティブな物語展開
- 🏁 最終決戦で物語を完結
- ⚡ **パフォーマンス最適化済み**（Streamlit Community Cloud対応）

## 🚀 デモ

**[Streamlit Cloudで公開中](https://daikiri-fairy-tale-app.streamlit.app)**

*※ 上記のURLは、Streamlit Cloudでデプロイ後に実際のURLに更新されます*

## ⚡ パフォーマンス最適化

このアプリは**Streamlit Community Cloud**での動作を最優先に設計されています：

### 🎯 最適化ポイント

1. **キャッシュ戦略**
   - `@st.cache_data`: データ処理の結果をキャッシュ
   - `@st.cache_resource`: リソース（API接続など）をキャッシュ
   - TTL（Time To Live）設定で適切なキャッシュ期限

2. **メモリ効率**
   - 必要最小限のデータのみ保持
   - セッション状態の定期的なクリーンアップ
   - ガベージコレクションの最適化

3. **処理時間の最適化**
   - 重い処理の分割と並列化
   - プログレス表示によるUX向上
   - タイムアウト設定

4. **データ読み込みの最適化**
   - 必要なデータのみを段階的に読み込み
   - 大規模データセットの分割処理
   - 効率的なデータ型の使用

### 🔧 技術的実装

```python
# キャッシュ付き関数の例
@st.cache_data(ttl=3600)  # 1時間キャッシュ
def generate_story_round(_model, round_num, crab_summon):
    # 物語生成処理
    pass

@st.cache_resource
def initialize_gemini():
    # Gemini API初期化（一度だけ実行）
    pass
```

## 🎮 遊び方

1. **召喚開始**: カニが召喚するキャラクターを入力（例：蜂、栗、臼、牛の糞など）
2. **戦闘ラウンド**: カニの召喚 → サルの反撃召喚 → 物語展開（5ラウンド）
3. **物語進行**: 各ラウンドで新しい展開が生成される
4. **最終決戦**: 5ラウンド後の最終決戦
5. **新しい物語**: 終了後、新しい物語を始めることができます

## 🛠️ セットアップ

### 1. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 2. 環境変数の設定

`.env`ファイルを作成し、Gemini APIキーを設定してください：

```
GOOGLE_API_KEY=your_gemini_api_key_here
```

### 3. アプリの起動

```bash
streamlit run app.py
```

## 📁 ファイル構成

```
大喜利童話（さるかに召還合戦）/
├── app.py                    # メインアプリケーション（最適化済み）
├── utils.py                  # パフォーマンス最適化ユーティリティ
├── requirements.txt          # 依存関係
├── README.md                # このファイル
├── .streamlit/              # Streamlit設定
│   └── config.toml         # パフォーマンス最適化設定
├── packages.txt             # システムパッケージ
└── 大喜利童話（さるかに合戦編）.txt  # 参考資料
```

## 🎯 物語の流れ

1. **冒頭**: 親を殺された子カニが復讐を誓う
2. **召喚開始**: 読者がカニの召喚キャラクターを選ぶ
3. **戦闘ラウンド**: カニの召喚 → サルの反撃召喚 → 物語展開（5ラウンド）
4. **最終決戦**: 5ラウンド後の最終決戦
5. **結末**: 「めでたしめでたし」で終了

## 🔧 技術仕様

- **フレームワーク**: Streamlit
- **AI**: Google Gemini API
- **言語**: Python 3.8+
- **UI**: カスタムCSS（メモリ効率最適化）
- **デプロイ**: Streamlit Community Cloud
- **パフォーマンス**: キャッシュ戦略、メモリ最適化、処理時間短縮

## ⚠️ 注意事項

- Gemini APIキーが必要です
- インターネット接続が必要です
- 物語の生成には数秒かかる場合があります
- Streamlit Community Cloudの制限に最適化されています

## 🚀 Streamlit Cloud デプロイ

1. GitHubリポジトリを[Streamlit Cloud](https://streamlit.io/cloud)に接続
2. リポジトリURL: `https://github.com/イカクラゲ/daikiri-fairy-tale-app`
3. メインファイル: `app.py`
4. 環境変数: `GOOGLE_API_KEY`を設定

## 📊 パフォーマンス指標

- **起動時間**: < 5秒
- **物語生成時間**: < 10秒
- **メモリ使用量**: < 512MB
- **キャッシュ効率**: 90%以上

## 🔄 更新履歴

- **v2.0**: パフォーマンス最適化実装
- **v1.0**: 初期リリース 